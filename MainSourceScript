--[[
    UTG COMPLETE SCRIPT PACKAGE
    
    Features:
    - Auto Roll (Press V to toggle)
    - Infinite Jump (Press X to toggle)
    - Anti-AFK
    - Hitbox Expander
    - Notification System
    
    Made by JN HH Gaming
]]

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer

-- ===========================
-- NOTIFICATION FUNCTION
-- ===========================

local function sendNotification(title, text, duration)
    pcall(function()
        game.StarterGui:SetCore("SendNotification", {
            Title = title;
            Text = text;
            Duration = duration or 3;
        })
    end)
end

-- ===========================
-- AUTO ROLL CONFIGURATION
-- ===========================

local ROLL_TOGGLE_KEY = Enum.KeyCode.V
local MIN_FALL_DISTANCE = 9
local MIN_TIMING = 0.008
local MAX_TIMING = 0.050
local AUTO_ROLL_ENABLED = true

local NOTIFY_ON_STARTUP = true
local NOTIFY_ON_TOGGLE = true
local NOTIFY_ON_FIRST_ROLL = true

-- ===========================
-- INFINITE JUMP CONFIGURATION
-- ===========================

local InfiniteJumpEnabled = false
local JUMP_TOGGLE_KEY = Enum.KeyCode.X

-- ===========================
-- HITBOX EXPANDER CONFIGURATION
-- ===========================

_G.HeadSize = 12
_G.Disabled = true

-- ===========================
-- AUTO ROLL: PRESS C FUNCTION
-- ===========================

local function pressC()
    local success = pcall(function()
        local vim = game:GetService("VirtualInputManager")
        vim:SendKeyEvent(true, "C", false, game)
        wait(0.02)
        vim:SendKeyEvent(false, "C", false, game)
    end)
    
    if not success then
        pcall(function()
            game:GetService("VirtualUser"):TypeKey("C")
        end)
    end
end

-- ===========================
-- AUTO ROLL: GUI
-- ===========================

local function createAutoRollGUI()
    if LocalPlayer.PlayerGui:FindFirstChild("UTG_AutoRoll") then
        LocalPlayer.PlayerGui.UTG_AutoRoll:Destroy()
    end
    
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "UTG_AutoRoll"
    screenGui.ResetOnSpawn = false
    screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    
    local mainFrame = Instance.new("Frame")
    mainFrame.Size = UDim2.new(0, 220, 0, 110)
    mainFrame.Position = UDim2.new(0, 10, 0.5, -55)
    mainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
    mainFrame.BorderSizePixel = 0
    mainFrame.Parent = screenGui
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 10)
    corner.Parent = mainFrame
    
    local stroke = Instance.new("UIStroke")
    stroke.Color = Color3.fromRGB(60, 60, 80)
    stroke.Thickness = 2
    stroke.Parent = mainFrame
    
    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(1, 0, 0, 25)
    title.BackgroundTransparency = 1
    title.Text = "ğŸ¯ UTG SCRIPT"
    title.TextColor3 = Color3.fromRGB(255, 255, 255)
    title.TextSize = 14
    title.Font = Enum.Font.GothamBold
    title.Parent = mainFrame
    
    local rollStatus = Instance.new("TextLabel")
    rollStatus.Name = "RollStatus"
    rollStatus.Size = UDim2.new(1, 0, 0, 18)
    rollStatus.Position = UDim2.new(0, 0, 0, 25)
    rollStatus.BackgroundTransparency = 1
    rollStatus.Text = "Auto Roll: ENABLED"
    rollStatus.TextColor3 = Color3.fromRGB(0, 255, 100)
    rollStatus.TextSize = 11
    rollStatus.Font = Enum.Font.GothamBold
    rollStatus.Parent = mainFrame
    
    local jumpStatus = Instance.new("TextLabel")
    jumpStatus.Name = "JumpStatus"
    jumpStatus.Size = UDim2.new(1, 0, 0, 18)
    jumpStatus.Position = UDim2.new(0, 0, 0, 43)
    jumpStatus.BackgroundTransparency = 1
    jumpStatus.Text = "Infinite Jump: DISABLED"
    jumpStatus.TextColor3 = Color3.fromRGB(255, 60, 60)
    jumpStatus.TextSize = 11
    jumpStatus.Font = Enum.Font.GothamBold
    jumpStatus.Parent = mainFrame
    
    local stats = Instance.new("TextLabel")
    stats.Name = "Stats"
    stats.Size = UDim2.new(1, 0, 0, 15)
    stats.Position = UDim2.new(0, 0, 0, 61)
    stats.BackgroundTransparency = 1
    stats.Text = "Rolls: 0"
    stats.TextColor3 = Color3.fromRGB(100, 200, 255)
    stats.TextSize = 10
    stats.Font = Enum.Font.GothamMedium
    stats.Parent = mainFrame
    
    local controls = Instance.new("TextLabel")
    controls.Size = UDim2.new(1, 0, 0, 28)
    controls.Position = UDim2.new(0, 0, 0, 76)
    controls.BackgroundTransparency = 1
    controls.Text = "V = Auto Roll\nX = Infinite Jump"
    controls.TextColor3 = Color3.fromRGB(120, 120, 150)
    controls.TextSize = 9
    controls.Font = Enum.Font.Gotham
    controls.Parent = mainFrame
    
    screenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")
    
    return rollStatus, jumpStatus, stats
end

-- ===========================
-- AUTO ROLL: FALL DETECTION
-- ===========================

local isFalling = false
local hasRolled = false
local fallStartY = 0
local rollScheduled = false
local totalRolls = 0

local function calculateLandingTime(character)
    local hrp = character:FindFirstChild("HumanoidRootPart")
    if not hrp then return nil, nil end
    
    local origin = hrp.Position
    local direction = Vector3.new(0, -1000, 0)
    
    local params = RaycastParams.new()
    params.FilterDescendantsInstances = {character}
    params.FilterType = Enum.RaycastFilterType.Exclude
    
    local result = workspace:Raycast(origin, direction, params)
    
    if result then
        local distance = result.Distance
        local velocity = hrp.AssemblyLinearVelocity.Y
        local gravity = workspace.Gravity
        local discriminant = velocity^2 + 2 * gravity * distance
        
        if discriminant >= 0 then
            local time = (-velocity - math.sqrt(discriminant)) / gravity
            return time, distance
        end
    end
    
    return nil, nil
end

local rollStatusLabel, jumpStatusLabel, statsLabel

local function autoRollLoop()
    local character = LocalPlayer.Character
    if not character then return end
    
    local humanoid = character:FindFirstChild("Humanoid")
    local hrp = character:FindFirstChild("HumanoidRootPart")
    
    if not humanoid or not hrp then return end
    
    local velocity = hrp.AssemblyLinearVelocity
    local currentY = hrp.Position.Y
    
    if velocity.Y < -5 and humanoid:GetState() == Enum.HumanoidStateType.Freefall then
        if not isFalling then
            isFalling = true
            fallStartY = currentY
            hasRolled = false
            rollScheduled = false
        end
        
        local fallDistance = fallStartY - currentY
        
        if fallDistance >= MIN_FALL_DISTANCE and not hasRolled and not rollScheduled and AUTO_ROLL_ENABLED then
            local timeToLand, distanceToGround = calculateLandingTime(character)
            
            if timeToLand and timeToLand > 0 then
                local randomMs = math.random(MIN_TIMING * 1000, MAX_TIMING * 1000)
                local randomOffset = randomMs / 1000
                local rollDelay = math.max(0, timeToLand - randomOffset)
                
                rollScheduled = true
                
                task.delay(rollDelay, function()
                    if AUTO_ROLL_ENABLED and isFalling and not hasRolled then
                        pressC()
                        hasRolled = true
                        totalRolls = totalRolls + 1
                        
                        if statsLabel then
                            statsLabel.Text = "Rolls: " .. totalRolls
                        end
                        
                        if NOTIFY_ON_FIRST_ROLL and totalRolls == 1 then
                            sendNotification("ğŸ¯ First Roll!", "Auto-roll working perfectly!", 3)
                        end
                    end
                end)
            end
        end
    else
        if isFalling then
            isFalling = false
            hasRolled = false
            rollScheduled = false
        end
    end
end

-- ===========================
-- AUTO ROLL: TOGGLE
-- ===========================

local function toggleAutoRoll()
    AUTO_ROLL_ENABLED = not AUTO_ROLL_ENABLED
    
    if rollStatusLabel then
        if AUTO_ROLL_ENABLED then
            rollStatusLabel.Text = "Auto Roll: ENABLED"
            rollStatusLabel.TextColor3 = Color3.fromRGB(0, 255, 100)
        else
            rollStatusLabel.Text = "Auto Roll: DISABLED"
            rollStatusLabel.TextColor3 = Color3.fromRGB(255, 60, 60)
        end
    end
    
    if NOTIFY_ON_TOGGLE then
        sendNotification(
            AUTO_ROLL_ENABLED and "âœ… Auto-Roll Enabled" or "âŒ Auto-Roll Disabled",
            AUTO_ROLL_ENABLED and "Auto-roll is now active!" or "Auto-roll is now inactive",
            3
        )
    end
end

-- ===========================
-- INFINITE JUMP
-- ===========================

UserInputService.JumpRequest:connect(function()
    if InfiniteJumpEnabled then
        local character = LocalPlayer.Character
        if character then
            local humanoid = character:FindFirstChildOfClass("Humanoid")
            if humanoid then
                humanoid:ChangeState("Jumping")
            end
        end
    end
end)

local function toggleInfiniteJump()
    InfiniteJumpEnabled = not InfiniteJumpEnabled
    
    if jumpStatusLabel then
        if InfiniteJumpEnabled then
            jumpStatusLabel.Text = "Infinite Jump: ENABLED"
            jumpStatusLabel.TextColor3 = Color3.fromRGB(0, 255, 100)
        else
            jumpStatusLabel.Text = "Infinite Jump: DISABLED"
            jumpStatusLabel.TextColor3 = Color3.fromRGB(255, 60, 60)
        end
    end
    
    sendNotification(
        "Infinite Jump",
        InfiniteJumpEnabled and "Enabled" or "Disabled",
        2
    )
end

-- ===========================
-- INPUT HANDLING
-- ===========================

UserInputService.InputBegan:connect(function(input, gameProcessed)
    if gameProcessed then return end
    
    if input.KeyCode == ROLL_TOGGLE_KEY then
        toggleAutoRoll()
    elseif input.KeyCode == JUMP_TOGGLE_KEY then
        toggleInfiniteJump()
    end
end)

-- ===========================
-- ANTI-AFK
-- ===========================

local vu = game:GetService("VirtualUser")
LocalPlayer.Idled:connect(function()
    vu:Button2Down(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
    wait(1)
    vu:Button2Up(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
end)

-- ===========================
-- HITBOX EXPANDER
-- ===========================

RunService.RenderStepped:connect(function()
    if _G.Disabled then
        for i,v in next, Players:GetPlayers() do
            if v.Name ~= LocalPlayer.Name then
                pcall(function()
                    v.Character.HumanoidRootPart.Size = Vector3.new(_G.HeadSize, _G.HeadSize, _G.HeadSize)
                    v.Character.HumanoidRootPart.Transparency = 0.7
                    v.Character.HumanoidRootPart.BrickColor = BrickColor.new("Really black")
                    v.Character.HumanoidRootPart.Material = "Neon"
                    v.Character.HumanoidRootPart.CanCollide = false
                end)
            end
        end
    end
end)

-- ===========================
-- AUTO ROLL LOOP
-- ===========================

RunService.Heartbeat:Connect(function()
    if LocalPlayer.Character then
        autoRollLoop()
    end
end)

-- ===========================
-- CHARACTER RESPAWN HANDLER
-- ===========================

LocalPlayer.CharacterAdded:Connect(function()
    isFalling = false
    hasRolled = false
    rollScheduled = false
    fallStartY = 0
    
    task.wait(1)
    rollStatusLabel, jumpStatusLabel, statsLabel = createAutoRollGUI()
end)

-- ===========================
-- INITIALIZATION
-- ===========================

rollStatusLabel, jumpStatusLabel, statsLabel = createAutoRollGUI()

-- Startup Notifications
sendNotification("made by JN HH Gaming", "", 3)

wait(1)

sendNotification("Recording now", "Press F2 3 times to save recording", 60)

wait(1)

if NOTIFY_ON_STARTUP then
    sendNotification("ğŸ¯ UTG Complete Script", "All features loaded successfully!", 4)
end

wait(1)

sendNotification("Infinite Jump", "Loaded | Press X to toggle", 5)

print("â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—")
print("â•‘     UTG COMPLETE SCRIPT LOADED        â•‘")
print("â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£")
print("â•‘  âœ“ Auto Roll (V to toggle)            â•‘")
print("â•‘  âœ“ Infinite Jump (X to toggle)        â•‘")
print("â•‘  âœ“ Anti-AFK                           â•‘")
print("â•‘  âœ“ Hitbox Expander                    â•‘")
print("â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£")
print("â•‘  Made by SARSARSARSAR                 â•‘")
print("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
